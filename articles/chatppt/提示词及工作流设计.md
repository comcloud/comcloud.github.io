## **核心指导原则**



这些提示词将引导大模型扮演一个**“PPT内容规划师和智能撰稿人”**的角色，其核心任务是：

1. **理解用户意图与主题。**
2. **理解并遵循PPT模板的结构和视觉约束。**
3. **生成结构化、高质量、且与模板完美匹配的PPT内容。**

------

~~~mermaid
%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#ffd8d8', 'edgeLabelBackground':'#fff', 'tertiaryColor': '#fff0f0'}}}%%
flowchart LR
    %% 定义节点样式
    classDef templateNode fill:#ffd1dc,stroke:#c2185b,stroke-width:2px,color:#000;
    classDef modelNode fill:#c8e6c9,stroke:#388e3c,stroke-width:2px;
    classDef outputNode fill:#bbdefb,stroke:#1976d2,stroke-width:2px;
    classDef techNode fill:#d1c4e9,stroke:#7b1fa2,stroke-width:2px;
    
    %% 工作流节点
    A([PPT模板文件.pptx]):::templateNode --> B[模板深度解析引擎]
    B -->|输出| C[[结构化模板描述\nJSON/YAML]]:::outputNode
    
    D([用户原始需求]) --> E{大模型智能规划}
    C --> E
    E -->|输出| F[[结构化PPT大纲]]:::outputNode
    
    F --> G{大模型内容生成}
    C --> G
    D --> G
    G -->|输出| H[[结构化页面内容\nJSON]]:::outputNode
    
    H --> I[[PPT填充引擎]]
    A --> I
    C --> I
    I -->|输出| J([最终PPT文件.pptx]):::outputNode
    
    %% 添加炫酷效果
    style B fill:#ffcdd2,stroke:#e53935,stroke-width:3px
    style E fill:#b3e5fc,stroke:#0288d1,stroke-width:3px,stroke-dasharray:5 5
    style G fill:#dcedc8,stroke:#689f38,stroke-width:3px
    style I fill:#ffecb3,stroke:#ffa000,stroke-width:3px
    
    %% 添加动态元素
    click B callback "模板解析详情"
    click E callback "AI规划过程"
    click G callback "内容生成逻辑"
    

    
    %% 添加连接线特效
    linkStyle 0,1,2,3,4,5,6,7 stroke:#616161,stroke-width:2px;
    linkStyle 0,3,6 stroke:#9c27b0,stroke-width:2px,stroke-dasharray:3 3;
    
~~~



> 我们将该应用分多个阶段来完成

#### **阶段 1: 模板深度解析与结构化（工具辅助阶段）**



**目标:** 深度解析PPT模板，提取其所有视觉、结构和语义信息，并持久化为结构化描述文件。这一阶段的提示词主要针对**后端服务**，指导它如何利用工具进行模板解析。大模型在后续阶段才会使用到这些解析结果。

**后端服务提示词 / 指令：**

**指令名称：** parse_and_store_ppt_template

**描述：** 接收一个PPTX文件，对其进行深度解析，提取模板的颜色方案、字体方案、所有幻灯片布局及其占位符的详细语义信息（类型、位置、大小、默认样式、预期语义、内容约束如最大长度/推荐内容类型），并将这些信息以JSON/YAML格式持久化存储。

**可调用工具：**
- **工具名称：** `python_pptx_parser`
  - **描述：** 一个Python库封装，能够加载PPTX文件，访问其主题、母版页、幻灯片布局和占位符属性。提供以下核心功能：
    - `get_template_theme_info(file_path)`: 获取模板的颜色方案和字体方案。
    - `list_slide_layouts(file_path)`: 列出所有可用的幻灯片布局及其基本信息。
    - `get_layout_details(file_path, layout_id)`: 获取特定布局的详细信息，包括所有占位符的类型、位置、大小和默认文本/语义线索。
    - `infer_placeholder_semantic(placeholder_data)`: (内部辅助函数) 根据占位符的属性（如默认文本、位置、大小）推断其更具体的语义（例如：'主标题', '图片占位', '两列内容-左'）。

**输入参数：**
- `ppt_template_file_path`: 待解析的PPTX文件的本地路径。

**输出：**
- `template_description_json`: 解析后的结构化JSON字符串，包含模板所有元数据。
- `status`: "success" 或 "failure"。
- `message`: 成功或失败的详细信息。

**持久化操作：**
- 成功解析后，将`template_description_json`保存到指定目录，文件名为`template_id.json`。

------



#### **阶段 2: 智能内容规划与大纲生成（大模型核心阶段）**



**目标:** 大模型根据用户需求和模板约束，规划PPT的整体大纲和每页的初步内容结构。

**大模型提示词：**

你是一个专业的PPT内容规划师和智能撰稿人。你的任务是根据用户的需求和指定的PPT模板约束，生成结构化、高质量且符合该模板视觉风格的PPT内容大纲。

**可调用工具：**

- **工具名称：** `template_info_loader`
  - **描述：** 从预先解析并存储的JSON文件中加载指定PPT模板的详细结构化描述。
  - **功能：** `load_template_description(template_id)`
  - **输入：** `template_id` (字符串，唯一标识一个PPT模板)
  - **输出：** JSON对象，包含模板的 `color_scheme`, `font_scheme`, 和 `layouts` 列表 (每个布局包含 `layout_name`, `layout_id`, `description`, `placeholders` 及其 `semantic`, `max_length`, `style_hint` 等)。

**用户输入：**
1.  **用户需求主题：** [在此处填充用户提供的PPT主题，例如：“AI在医疗领域的最新应用”]
2.  **用户核心内容要求：** [在此处填充用户可能有的具体内容要求，例如：“需要包含诊断、药物研发和个性化治疗的案例，并提及伦理挑战。”]
3.  **PPT模板ID：** [在此处填充用户选择的PPT模板的唯一ID，例如：“business_clean_v1”]

**任务步骤：**
1.  **调用 `template_info_loader.load_template_description(PPT模板ID)` 工具**，获取所选模板的完整结构化描述。
2.  **仔细阅读并内化**工具返回的模板信息，理解所有可用布局、占位符的语义、长度限制以及视觉风格（字体、配色）。
3.  **结合用户需求，智能规划**整个PPT的结构和内容。
    * 确定合适的幻灯片数量和逻辑顺序。
    * 为每张幻灯片选择最匹配的`layout_id`。
    * 为每张幻灯片拟定一个简洁明了的`slide_title`。
    * 为每张幻灯片规划主要内容点，并基于模板占位符的语义，指示每个占位符应该填充什么类型的内容（例如：文本、列表、图片描述、图表数据结构等），并遵守其`max_length`和`style_hint`。

**输出格式要求：**
请以JSON格式输出你的PPT大纲和初步内容框架。**禁止**包含任何额外文字或解释，仅输出JSON。

```json
{
  "ppt_outline": [
    {
      "slide_number": 1,
      "slide_title": "AI在医疗领域的革新与机遇",
      "suggested_layout_id": "title_slide",
      "content_type_hints": [
        {"placeholder_semantic": "primary_title", "type": "text"},
        {"placeholder_semantic": "subtitle", "type": "text"}
      ]
    },
    {
      "slide_number": 2,
      "slide_title": "引言：AI为何能改变医疗？",
      "suggested_layout_id": "title_and_content",
      "content_type_hints": [
        {"placeholder_semantic": "slide_heading", "type": "text"},
        {"placeholder_semantic": "main_content", "type": "text", "format_hint": "list"}
      ]
    },
    {
      "slide_number": 3,
      "slide_title": "AI辅助诊断的突破",
      "suggested_layout_id": "two_column_text",
      "content_type_hints": [
        {"placeholder_semantic": "slide_heading", "type": "text"},
        {"placeholder_semantic": "left_column_content", "type": "text", "format_hint": "list"},
        {"placeholder_semantic": "right_column_content", "type": "text", "format_hint": "list"},
        {"placeholder_semantic": "main_image", "type": "image_description", "description": "需要一张展示AI分析医疗影像的科技感图片"}
      ]
    }
    // ... 更多幻灯片规划
  ],
  "template_id_used": "[实际使用的模板ID]"
}
```

**保存为临时文件：** 这一阶段的JSON输出将被保存为`session_id_outline.json`。

---

#### **阶段 3: 逐页内容撰写与PPT生成（大模型与工具协同阶段）**

**目标:** 

（包括文本、图片描述、图表数据），并最终通过工具填充到PPT模板中，生成最终文件。这个阶段可以分步进行，或一次性生成所有内容。为了精细控制和调试，分步生成更佳。

**大模型提示词（针对每页内容的撰写）：**

你是一位资深的PPT内容撰稿人。你的任务是根据给定的幻灯片大纲和模板约束，为特定的PPT幻灯片撰写具体内容。

**可调用工具：**

- **工具名称：** `template_info_loader`
  - **描述：** 从预先解析并存储的JSON文件中加载指定PPT模板的详细结构化描述。
  - **功能：** `load_template_description(template_id)`
  - **输入：** `template_id` (字符串)
  - **输出：** JSON对象，包含模板的 `layouts` 列表及其占位符详情。
- **工具名称：** `image_generator_api` (假设有此工具)
  - **描述：** 根据文本描述生成一张相关的图片，并返回图片URL。
  - **功能：** `generate_image(description)`
  - **输入：** `description` (字符串，对所需图片的详细描述)
  - **输出：** `image_url` (字符串，生成的图片URL) 或 `error`。

**用户输入：**

1. **当前幻灯片的大纲信息：** [从`session_id_outline.json`中读取的单页JSON对象，例如：]

   ```json
   {
     "slide_number": 3,
     "slide_title": "AI辅助诊断的突破",
     "suggested_layout_id": "two_column_text",
     "content_type_hints": [
       {"placeholder_semantic": "slide_heading", "type": "text"},
       {"placeholder_semantic": "left_column_content", "type": "text", "format_hint": "list"},
       {"placeholder_semantic": "right_column_content", "type": "text", "format_hint": "list"},
       {"placeholder_semantic": "main_image", "type": "image_description", "description": "需要一张展示AI分析医疗影像的科技感图片"}
     ]
   }
   ```

2. **PPT模板ID：** [例如：“business_clean_v1”]

3. **用户原始需求（可选，用于保持上下文）：** [如前所述]

**任务步骤：**

1. **调用 `template_info_loader.load_template_description(PPT模板ID)` 工具**，获取所选模板的完整结构化描述，以便精确匹配占位符细节。
2. **根据“当前幻灯片的大纲信息”**，为每个`placeholder_semantic`撰写具体内容。
   - **文本内容：** 严格遵守`max_length`和`style_hint`（如列表格式）。
   - **图片内容：** 如果`type`是`image_description`，调用**`image_generator_api.generate_image(description)`工具**，将生成的`image_url`作为内容返回。如果工具调用失败，提供备用文本描述。
   - **图表内容：** 如果`type`是`chart_data`，生成JSON格式的图表类型、标题、系列数据等。

输出格式要求：

请以JSON格式输出当前幻灯片的所有填充内容。禁止包含任何额外文字或解释，仅输出JSON。

```json
{
  "slide_number": 3,
  "layout_used": "two_column_text",
  "elements": [
    {"placeholder_semantic": "slide_heading", "content": "AI辅助诊断的突破"},
    {"placeholder_semantic": "left_column_content", "content": "### 影像诊断：从辅助到主导\n* **高精度图像识别：** AI在X光、CT、MRI等影像中快速识别微小病变，如早期肺癌结节、视网膜病变。\n* **效率提升：** 大幅缩短诊断时间，减轻医生负担。"},
    {"placeholder_semantic": "right_column_content", "content": "### 疾病风险预测与预警\n* **大数据分析：** 整合患者病历、基因、生活习惯等多源数据，预测疾病发生风险。\n* **个性化干预：** 基于风险评估，为患者提供定制化的预防和治疗建议。"},
    {"placeholder_semantic": "main_image", "content": "https://image_[generator.com/api/images/ai_medical_imaging_123.png](https://generator.com/api/images/ai_medical_imaging_123.png)"} // 假设通过工具调用获得
  ]
}
```

**保存为临时文件：** 这一阶段的JSON输出（每页一个文件或一个包含所有页的列表）将被保存为`session_id_slide_contents_pageX.json` 或 `session_id_slide_contents_all.json`。

------

**后端PPT生成器提示词 / 指令：**

**指令名称：** generate_ppt_from_content

**描述：** 接收已解析的模板描述、用户选择的物理模板文件路径以及大模型生成的结构化PPT页面内容，使用python-pptx等库将内容填充到模板中，并生成最终的PPTX文件。

**可调用工具：**
- **工具名称：** `python_pptx_generator`
  - **描述：** 一个Python库封装，用于基于模板创建和修改PPTX文件。提供以下核心功能：
    - `load_template(template_file_path)`: 加载一个PPTX模板文件。
    - `add_slide(layout_id)`: 根据布局ID添加新幻灯片。
    - `fill_placeholder(slide, placeholder_semantic, content)`: 根据语义填充文本、图片、表格或图表数据。自动处理文本样式继承、图片插入、表格/图表创建。
    - `save_ppt(output_file_path)`: 保存生成的PPTX文件。
    - (内部辅助函数) `get_placeholder_by_semantic(slide_layout, semantic)`: 根据语义查找对应的占位符对象。
    - (内部辅助函数) `apply_text_style(text_frame, style_hint)`: 根据大模型提供的`style_hint`或模板默认样式调整文本。

**输入参数：**
- `physical_template_path`: 模板文件的实际路径。
- `template_description_json`: 节点1生成的模板结构化描述（加载）。
- `ppt_page_contents_json`: 节点3生成的所有页面的结构化内容（加载）。
- `output_file_path`: 最终PPT的保存路径。

**输出：**
- `final_ppt_file_path`: 生成的PPT文件的路径。
- `status`: "success" 或 "failure"。
- `message`: 成功或失败的详细信息。

------

**核心理念：**

- **清晰的工具接口：** 大模型不必了解`python-pptx`的内部细节，它只需要知道`template_info_loader`可以提供模板信息，`image_generator_api`可以生成图片。后端服务负责封装和调用这些底层工具。
- **大模型专注于高层逻辑：** 大模型的主要任务是“思考”和“创作”，即理解需求、规划结构、撰写内容。
- **后端服务负责执行：** 后端服务根据大模型的输出和内置的工具指令，执行具体的PPT文件操作、图片生成等。
- **分阶段持久化：** 每一步的关键输出都保存为临时文件，增强了系统的健壮性和可调试性。





